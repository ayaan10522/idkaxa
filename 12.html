<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
  <title>Arena Player App — Glass UI</title>

  <!-- Firebase (same as your file) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Fonts & icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* -------------------------
       Premium Liquid Glass UI
       Option 3: Dark Neon Glass
       ------------------------- */
    :root{
      --bg-1: #07070b;            /* page background base */
      --bg-2: rgba(15,18,25,0.6); /* blurred overlay */
      --card: rgba(255,255,255,0.04);
      --glass-border: rgba(255,255,255,0.06);
      --muted: #9aa3a8;
      --accent: #3ee07a;         /* neon green accent (keeps your green) */
      --accent-2: #2ce3ff;       /* cyan highlight */
      --glass-blur: 14px;
      --radius: 16px;
      --glass-shadow: 0 10px 30px rgba(2,6,23,0.6);
      --glass-glow: 0 6px 30px rgba(62,224,122,0.08);
      --max-width: 520px;
      --safe-pad: 18px;
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Page */
    html,body{
      height:100%;
      margin:0;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(46, 105, 255, 0.06), transparent 10%),
        radial-gradient(900px 500px at 80% 80%, rgba(46, 255, 180, 0.03), transparent 15%),
        linear-gradient(180deg,var(--bg-1), #05050a);
      color: #eaf2ee;
      -webkit-user-select:none;
      user-select:none;
    }

    /* App container */
    .app-wrap{
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px 18px;
      box-sizing:border-box;
    }

    .app-screen{
      width:100%;
      max-width:var(--max-width);
      height:calc(100vh - 80px);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:24px;
      overflow:hidden;
      position:relative;
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(8px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
    }

    /* soft colorful behind-light */
    .app-screen::before{
      content:"";
      position:absolute;
      inset: -30% -10% auto auto;
      width: 60%;
      height: 60%;
      background: linear-gradient(120deg, rgba(46,105,255,0.06), rgba(62,224,122,0.06));
      filter: blur(70px);
      pointer-events:none;
      z-index:0;
    }

    /* top header area */
    .topbar{
      display:flex;
      align-items:center;
      gap:12px;
      padding:18px var(--safe-pad);
      z-index:2;
      position:relative;
    }
    .logo{
      width:52px;
      height:52px;
      min-width:52px;
      border-radius:14px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 0 6px 18px rgba(0,0,0,0.5), var(--glass-glow);
      transform: translateZ(0);
      backdrop-filter: blur(var(--glass-blur));
    }
    .logo svg{ width:26px;height:26px; transform: rotate(-10deg); fill: var(--accent); }

    .title{
      display:flex;
      flex-direction:column;
      line-height:1;
    }
    .title h1{
      margin:0;
      font-size:18px;
      font-weight:700;
      color:#eefaf0;
      letter-spacing:0.1px;
    }
    .title p{
      margin:0;
      color:var(--muted);
      font-size:12px;
      margin-top:2px;
    }

    /* main scroll area */
    .scroll-content{
      padding:20px var(--safe-pad);
      overflow:auto;
      flex:1;
      display:none; /* toggled by .active */
      gap:14px;
      z-index:2;
    }
    .scroll-content.active{ display:flex; flex-direction:column; }

    .scroll-content::-webkit-scrollbar{ height:8px; width:8px; }
    .scroll-content::-webkit-scrollbar-thumb{ background:rgba(255,255,255,0.04); border-radius:20px; }

    /* glass card */
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--glass-shadow);
      backdrop-filter: blur(var(--glass-blur));
      transition: transform .28s cubic-bezier(.2,.9,.3,1), box-shadow .28s;
      position:relative;
      overflow:hidden;
    }
    .card:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(2,6,23,0.7); }

    /* forms */
    .input-label{ font-size:12px; color:var(--muted); margin:8px 4px 6px; display:block; }
    .input-field{
      width:100%;
      padding:14px 14px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      color: #e9f7ee;
      outline:none;
      font-size:15px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.015);
      transition: box-shadow .18s, transform .18s;
      backdrop-filter: blur(6px);
    }
    .input-field::placeholder{ color: rgba(230,240,235,0.25); }
    .input-field:focus{ box-shadow: 0 6px 24px rgba(62,224,122,0.06); transform: translateY(-1px); border-color: rgba(62,224,122,0.18); }

    /* buttons */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      border-radius:999px;
      padding:12px 16px;
      font-weight:700;
      font-size:15px;
      border:none;
      cursor:pointer;
      transition: transform .18s, box-shadow .18s;
      color: #07110a;
      background: linear-gradient(90deg,var(--accent), #30d076);
      box-shadow: 0 8px 30px rgba(62,224,122,0.12), 0 2px 6px rgba(0,0,0,0.6);
    }
    .btn:active{ transform: translateY(1px); }
    .btn-ghost{
      background:transparent;
      color:var(--muted);
      border:1px solid rgba(255,255,255,0.04);
      padding:10px 12px;
      border-radius:12px;
    }
    .btn-sm{
      padding:8px 12px;
      border-radius:12px;
      font-size:13px;
      font-weight:600;
    }

    /* login/signup layout center */
    .center-panel{
      width:100%;
      max-width:420px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      align-items:stretch;
    }

    .link-text{
      color:var(--accent);
      text-decoration:underline;
      text-align:center;
      font-size:13px;
      cursor:pointer;
    }

    /* wallet card specific */
    .wallet-row{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
    .wallet-value{ font-size:24px; font-weight:800; color:#f6fff7; }

    /* booking area */
    .calendar-strip{
      display:flex;
      gap:10px;
      overflow:auto;
      padding:6px 2px 12px 2px;
      min-height:72px;
    }
    .cal-day{
      min-width:64px;
      border-radius:12px;
      padding:10px 8px;
      text-align:center;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border: 1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      transition: transform .14s, box-shadow .14s;
      flex-shrink:0;
    }
    .cal-day:hover{ transform: translateY(-4px); box-shadow: 0 10px 24px rgba(0,0,0,0.6); }
    .cal-day.selected{ background: linear-gradient(180deg, rgba(62,224,122,0.08), rgba(46, 105, 255,0.02)); border-color: rgba(62,224,122,0.18); color:#eafdf2; }

    /* slots */
    .slot-item{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding:14px;
      border-radius:12px;
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      transition: transform .12s, box-shadow .12s;
    }
    .slot-item:hover{ transform: translateY(-6px); box-shadow: 0 18px 40px rgba(0,0,0,0.5); }
    .slot-item.selected{ border-color: rgba(62,224,122,0.18); box-shadow: 0 16px 40px rgba(62,224,122,0.05); }
    .slot-item.full{ opacity:0.5; filter:grayscale(0.6); pointer-events:none; }
    .slot-item.maintenance{ border-color: rgba(255,80,80,0.12); background: linear-gradient(180deg, rgba(255,80,80,0.02), rgba(255,80,80,0.01)); }

    .slot-details div:first-child{ font-weight:700; color:#eafdf2; }
    .slot-details div:last-child{ color:var(--muted); font-size:13px; margin-top:6px; }

    .status-badge{
      padding:6px 10px;
      border-radius:10px;
      font-size:12px;
      font-weight:700;
      color:#fff;
      background: rgba(0,0,0,0.35);
      border:1px solid rgba(255,255,255,0.04);
    }
    .status-badge.low{ color: #ffdf6b; background: linear-gradient(90deg,#ff9b6b,#ffdf6b); }
    .status-badge.maint{ background: linear-gradient(90deg,#ff5c5c,#ff9b6b); }

    /* warning banner */
    .warning-banner{
      background: linear-gradient(90deg, rgba(255,80,80,0.12), rgba(255,80,80,0.06));
      border: 1px solid rgba(255,80,80,0.12);
      color: #ffdede;
      padding:12px;
      border-radius:12px;
      text-align:center;
      display:none;
    }

    /* bottom action bar (floating) */
    #action_bar{
      position:fixed;
      left:50%;
      transform: translateX(-50%);
      bottom:24px;
      width: calc(100% - 48px);
      max-width:480px;
      z-index:40;
      border-radius:16px;
      padding:14px;
      display:none;
      background: linear-gradient(180deg, rgba(10,12,15,0.9), rgba(8,9,11,0.85));
      border:1px solid rgba(255,255,255,0.04);
      box-shadow: 0 20px 50px rgba(0,0,0,0.6);
      backdrop-filter: blur(8px);
    }

    .qty-selector{ display:flex; gap:10px; justify-content:center; padding:8px 6px; flex-wrap:wrap; }
    .qty-btn{
      border-radius:999px;
      padding:10px 12px;
      min-width:44px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border:1px solid rgba(255,255,255,0.03);
      cursor:pointer;
      color:#dbeee0;
    }
    .qty-btn.active{ background: linear-gradient(90deg,var(--accent), #2fd26f); color:#03100b; box-shadow: 0 10px 30px rgba(62,224,122,0.08); }

    /* bottom nav */
    .bottom-nav{
      position:sticky;
      bottom:0;
      width:100%;
      display:flex;
      gap:18px;
      justify-content:space-around;
      padding:12px var(--safe-pad);
      margin-top:auto;
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
      border-top: 1px solid rgba(255,255,255,0.02);
      backdrop-filter: blur(6px);
    }
    .nav-icon{ display:flex; flex-direction:column; align-items:center; gap:6px; color:rgba(255,255,255,0.5); cursor:pointer; font-size:12px; }
    .nav-icon.active{ color:var(--accent); filter:drop-shadow(0 6px 30px rgba(62,224,122,0.06)); }
    .nav-icon svg{ width:22px;height:22px; fill:currentColor; }

    /* modal */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg, rgba(4,6,8,0.6), rgba(4,6,8,0.75));
      z-index:100;
      padding:20px;
    }
    .modal-content{
      width:100%;
      max-width:480px;
      border-radius:14px;
      padding:18px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      box-shadow: 0 30px 80px rgba(2,6,23,0.7);
      backdrop-filter: blur(12px);
      color:#eafcf0;
    }
    .modal h3{ margin:0 0 6px 0; font-size:18px; }
    .modal p{ margin:0 0 16px 0; color:var(--muted); font-size:14px; }

    /* small helpers */
    .muted{ color:var(--muted); }
    .center{ text-align:center; }
    .small{ font-size:13px; color:var(--muted); }

    /* responsive */
    @media (max-width:420px){
      .app-screen{ height:100vh; border-radius:18px; padding-bottom:80px; }
      .topbar{ padding:12px; }
      #action_bar{ left:12px; transform:none; width: calc(100% - 24px); }
      .logo{ width:44px; min-width:44px; height:44px; }
    }
  </style>
</head>
<body>

  <div class="app-wrap">
    <div class="app-screen" aria-live="polite">

      <!-- Topbar -->
      <div class="topbar">
        <div class="logo" aria-hidden="true">
          <!-- subtle neon logo -->
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10.5 2C8.01472 2 6 4.01472 6 6.5C6 8.62492 7.47137 10.4098 9.45696 10.8762L7.8693 17.2264C7.61658 18.2373 8.23161 19.2612 9.24249 19.5139C10.2534 19.7667 11.2773 19.1516 11.53 18.1407L13.2866 11.1143C13.8509 10.8089 14.3271 10.3692 14.6624 9.83292C15.7159 10.4915 17.1097 10.375 18.042 9.44264C19.2136 8.27107 19.2136 6.37158 18.042 5.20001C16.8704 4.02844 14.9709 4.02844 13.7994 5.20001C13.0846 5.91478 12.8273 6.90891 13.0136 7.80515C12.5235 6.69055 11.5945 5.83276 10.5 5.83276C10.1318 5.83276 9.83276 6.13182 9.83276 6.5C9.83276 6.86819 10.1318 7.16724 10.5 7.16724C10.8682 7.16724 11.1672 7.46629 11.1672 7.83448C11.1672 8.20267 10.8682 8.50172 10.5 8.50172C9.39473 8.50172 8.49856 7.60555 8.49856 6.5C8.49856 5.39445 9.39473 4.49828 10.5 4.49828C11.2357 4.49828 11.8812 4.90082 12.2161 5.50341C12.7189 3.47496 10.5 2 10.5 2Z" fill="currentColor"/><circle cx="16" cy="7.5" r="1.5" fill="currentColor"/></svg>
        </div>

        <div class="title">
          <h1 id="txt_welcome">Arena Login</h1>
          <p class="small">Book tables, manage wallet & view bookings</p>
        </div>

        <div style="flex:1"></div>

        <!-- wallet short -->
        <div style="display:flex; align-items:center; gap:10px;">
          <div class="card" style="padding:8px 12px; min-width:120px; display:flex; align-items:center; gap:10px;">
            <div style="width:10px;height:36px;border-radius:6px;background:linear-gradient(180deg,var(--accent), #2fd26f)"></div>
            <div style="line-height:1;">
              <div class="small muted">Wallet</div>
              <div id="txt_wallet" class="wallet-value">₹0</div>
            </div>
          </div>
        </div>
      </div>

      <!-- LOGIN SCREEN -->
      <div id="screen_login" class="scroll-content active" style="justify-content:center; align-items:center;">
        <div class="center-panel">

          <div style="text-align:center;margin-bottom:6px;">
            <h2 style="margin:6px 0 0 0;">Welcome back</h2>
            <div class="small muted" style="margin-top:6px;">Sign in to continue to Arena</div>
          </div>

          <div>
            <label class="input-label">Phone Number</label>
            <input type="tel" id="login_phone" class="input-field" placeholder="e.g. 9876543210" inputmode="tel" />
          </div>

          <div>
            <label class="input-label">Password</label>
            <input type="password" id="login_pass" class="input-field" placeholder="******" />
          </div>

          <button class="btn" onclick="handleLogin()" aria-label="Sign in">Sign In</button>

          <div class="link-text" onclick="goto('signup')">Don't have an account? Sign Up</div>
        </div>
      </div>

      <!-- SIGNUP SCREEN -->
      <div id="screen_signup" class="scroll-content" style="justify-content:center; align-items:center;">
        <div class="center-panel">

          <div style="text-align:center;margin-bottom:6px;">
            <h2 style="margin:6px 0 0 0;">Create Account</h2>
            <div class="small muted" style="margin-top:6px;">Quick sign up — join Arena</div>
          </div>

          <label class="input-label">Full Name</label>
          <input type="text" id="reg_name" class="input-field" placeholder="John Doe" />

          <label class="input-label">Phone Number</label>
          <input type="tel" id="reg_phone" class="input-field" placeholder="9876543210" inputmode="tel" />

          <label class="input-label">Age</label>
          <input type="number" id="reg_age" class="input-field" placeholder="25" />

          <label class="input-label">Create Password</label>
          <input type="password" id="reg_pass" class="input-field" placeholder="******" />

          <button class="btn btn-sm" onclick="handleSignup()">Create Account</button>
          <div class="link-text" onclick="goto('login')">Back to Sign In</div>
        </div>
      </div>

      <!-- DASHBOARD -->
      <div id="screen_dash" class="scroll-content">
        <div class="card" style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
          <div>
            <div class="small muted">Welcome</div>
            <div style="font-weight:800;font-size:20px;" id="txt_welcome_small">Player</div>
          </div>
          <div style="display:flex;gap:8px;align-items:center;">
            <button class="btn-ghost btn-sm" onclick="goto('booking')">Book Table</button>
            <button class="btn-ghost btn-sm" onclick="goto('mybookings')">My Bookings</button>
            <button class="btn-sm" style="background:linear-gradient(90deg,var(--accent), #2fd26f); color:#03100b;" onclick="showRecharge()">Recharge</button>
          </div>
        </div>

        <div class="card" style="display:flex;justify-content:space-between;align-items:center;">
          <div>
            <div class="small muted">Wallet Balance</div>
            <div id="txt_wallet_big" style="font-size:22px;font-weight:800;">₹0</div>
          </div>
          <div style="text-align:right;">
            <div class="small muted">Player</div>
            <div id="txt_welcome_name" style="font-weight:700;">—</div>
          </div>
        </div>

        <div class="card" onclick="goto('booking')" style="cursor:pointer;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <div style="font-weight:800;">Find & Reserve</div>
              <div class="small muted">Check available slots and reserve a table</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;">
              <div style="font-size:13px;color:var(--muted);">Fast & Secure</div>
              <div style="margin-top:8px;"><svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M5 12h14" stroke="#9aa3a8" stroke-width="1.6" stroke-linecap="round"/><path d="M12 5l7 7-7 7" stroke="#9aa3a8" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
            </div>
          </div>
        </div>

        <div style="text-align:center;" class="small muted">Tip: Use Recharge to add money or ask admin for codes.</div>

        <div style="margin-top:12px; text-align:center;">
          <button class="btn-ghost" onclick="handleLogout()">Log Out</button>
        </div>

      </div>

      <!-- BOOKING -->
      <div id="screen_booking" class="scroll-content">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
          <div style="font-size:20px;cursor:pointer;" onclick="goto('dash')">←</div>
          <h2 style="margin:0;">Book Table</h2>
        </div>

        <div id="day_block_banner" class="warning-banner">⛔ This day is blocked for bookings.</div>

        <div class="card">
          <div style="font-size:13px;color:var(--muted);margin-bottom:8px;">SELECT TABLE</div>
          <select id="sel_table" class="input-field styled-select" onchange="handleTableChange()" style="appearance:none; background-image:linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.02) 50%); background-position: calc(100% - 14px) center; background-repeat:no-repeat;">
            <option value="" disabled selected>Select a Table...</option>
          </select>
        </div>

        <div>
          <div class="small muted" style="padding-left:6px;margin-bottom:6px;">SELECT DATE</div>
          <div id="calendar_strip" class="calendar-strip"></div>
        </div>

        <h3 style="margin:12px 6px 6px 6px;">Available Slots</h3>

        <div id="slots_list">
          <div class="center small muted" style="margin-top:18px;">Select a table above to start booking.</div>
        </div>

      </div>

      <!-- action bar (floating) -->
      <div id="action_bar" role="dialog" aria-hidden="true">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <div class="small muted">How many seats?</div>
          <div style="font-weight:800;color:var(--accent);font-size:14px;" id="lbl_total_price">₹0</div>
        </div>

        <div class="qty-selector"></div>

        <div style="display:flex;gap:10px;margin-top:10px;">
          <button class="btn-ghost" style="flex:1" onclick="document.getElementById('action_bar').style.display='none'">Close</button>
          <button class="btn" style="flex:1" onclick="confirmBook()">Confirm & Pay</button>
        </div>
      </div>

      <!-- MY BOOKINGS -->
      <div id="screen_mybookings" class="scroll-content">
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
          <div style="font-size:20px;cursor:pointer;" onclick="goto('dash')">←</div>
          <h2 style="margin:0;">My Bookings</h2>
        </div>

        <div id="list_mybookings" class="card" style="min-height:120px; padding:12px;">
          <div class="center small muted">Loading...</div>
        </div>
      </div>

      <!-- bottom nav (keeps intact) -->
      <div id="nav_bar" class="bottom-nav" style="display:none;">
        <div class="nav-icon active" onclick="goto('dash')" id="btn_nav_dash" aria-label="Home">
          <svg viewBox="0 0 24 24"><path d="M12 2L3 9V20H21V9L12 2ZM12 4.9L19 10.5V18H5V10.5L12 4.9ZM11 12H13V18H11V12Z"/></svg>
          <span>Home</span>
        </div>
        <div class="nav-icon" onclick="goto('booking')" id="btn_nav_book" aria-label="Booking">
          <svg viewBox="0 0 24 24"><path d="M19 4H18V2H16V4H8V2H6V4H5C3.89543 4 3 4.89543 3 6V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V6C21 4.89543 20.1046 4 19 4ZM19 6V8H5V6H19ZM5 20V10H19V20H5Z"/></svg>
          <span>Booking</span>
        </div>
      </div>

      <!-- MODALS -->
      <div id="modal_recharge" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
          <h3>Add Money</h3>
          <p class="small muted">Enter Admin Code</p>
          <input id="inp_code" class="input-field" placeholder="e.g. ABCD-1234" />
          <div style="display:flex;gap:10px;margin-top:12px;">
            <button class="btn-ghost" style="flex:1" onclick="document.getElementById('modal_recharge').style.display='none'">Cancel</button>
            <button class="btn" style="flex:1" onclick="doRecharge()">Submit</button>
          </div>
        </div>
      </div>

      <div id="modal_generic" class="modal" role="alertdialog" aria-modal="true" aria-hidden="true">
        <div class="modal-content">
          <h3 id="modal_generic_title" style="margin-bottom:8px;">Alert</h3>
          <p id="modal_generic_msg" class="small muted"></p>
          <div style="display:flex;gap:10px;margin-top:12px;">
            <button id="modal_generic_cancel" class="btn-ghost" style="flex:1; display:none;" onclick="hideAppModal()">Cancel</button>
            <button id="modal_generic_ok" class="btn" style="flex:1" onclick="hideAppModal()">OK</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- --- App logic (kept intact from your original file) --- -->
  <script>
    // --- FIREBASE CONFIGURATION & INITIALIZATION ---
    // NOTE: kept your config just like original file
    const cfg = {
      apiKey: "AIzaSyC82WNipslgbxCObtoSs9a9o32LfMKQ7lo",
      authDomain: "wrwork.firebaseapp.com",
      databaseURL: "https://wrwork-default-rtdb.firebaseio.com",
      projectId: "wrwork",
      storageBucket: "wrwork.firebasestorage.app",
      messagingSenderId: "879424926024",
      appId: "1:879424926024:web:c07d7fc5bb2aca9dca437d",
      measurementId: "G-J0744QC9T9"
    };

    let db;
    try {
        firebase.initializeApp(cfg);
        db = firebase.database();
    } catch(e) {
        console.error("Firebase Initialization Error:", e);
        window.onload = () => showAppAlert("Connection Error: Check your Firebase configuration.");
    }

    // --- APP STATE ---
    let currentUserPhone = localStorage.getItem('arena_phone') || null;
    let currentBalance = 0;
    let selectedDateStr = new Date().toISOString().split('T')[0];
    let selectedTableId = null;
    let selectedSlotTime = null;
    let selectedSlotPrice = 0;

    let selectedQty = 1;
    let currentTableCapacity = 4;
    let maxDaysToShow = 7;
    const TOTAL_DAYS_TO_SHOW = 30;

    // --- IN-APP MODAL FUNCTIONS ---
    function hideAppModal() {
        document.getElementById('modal_generic').style.display = 'none';
        document.getElementById('modal_generic_cancel').style.display = 'none';
    }

    function showAppAlert(message, title = 'Alert') {
        document.getElementById('modal_generic_title').innerText = title;
        document.getElementById('modal_generic_msg').innerText = message;
        document.getElementById('modal_generic_ok').innerText = 'OK';
        document.getElementById('modal_generic_ok').onclick = hideAppModal;
        document.getElementById('modal_generic_ok').style.flex = '0 0 auto';
        document.getElementById('modal_generic_ok').style.width = '100%';
        document.getElementById('modal_generic').style.display = 'flex';
    }

    function showAppConfirm(message, callback, title = 'Confirm') {
        document.getElementById('modal_generic_title').innerText = title;
        document.getElementById('modal_generic_msg').innerText = message;

        document.getElementById('modal_generic_cancel').style.display = 'block';
        document.getElementById('modal_generic_ok').style.width = 'auto';
        document.getElementById('modal_generic_ok').style.flex = '1';
        document.getElementById('modal_generic_cancel').onclick = hideAppModal;

        document.getElementById('modal_generic_ok').innerText = 'Confirm';
        document.getElementById('modal_generic_ok').onclick = () => {
            hideAppModal();
            callback();
        };
        document.getElementById('modal_generic').style.display = 'flex';
    }

    // --- NAVIGATION ---
    function goto(screen) {
        document.querySelectorAll('.scroll-content').forEach(el => el.classList.remove('active'));
        document.getElementById('action_bar').style.display = 'none';

        const s = document.getElementById('screen_' + screen);
        if (!s) return console.warn('Screen not found', screen);
        s.classList.add('active');

        document.getElementById('nav_bar').style.display = (screen === 'login' || screen === 'signup') ? 'none' : 'flex';
        document.getElementById('btn_nav_dash').classList.toggle('active', screen === 'dash');
        document.getElementById('btn_nav_book').classList.toggle('active', screen === 'booking');

        if (screen === 'booking') {
            selectedTableId = null;
            selectedSlotTime = null;
            document.getElementById('slots_list').innerHTML = '<div style="text-align:center; color:#9aa3a8; margin-top:30px;">Select a table above to start booking.</div>';
            const sel = document.getElementById('sel_table');
            if (sel.options.length > 0) sel.selectedIndex = 0;
            maxDaysToShow = 7;
            loadTables();
            renderCalendar();
        }
        if (screen === 'mybookings') loadMyBookings();
    }

    // --- AUTH FUNCTIONS ---
    function handleSignup() {
        if (!db) return showAppAlert("Database connection failed.");
        const name = document.getElementById('reg_name').value.trim();
        const phone = document.getElementById('reg_phone').value.trim();
        const pass = document.getElementById('reg_pass').value.trim();
        const age = document.getElementById('reg_age').value.trim();
        if(!name || !phone || !pass || !age) return showAppAlert("All fields required");

        if (phone.length < 8) return showAppAlert("Please enter a valid phone number.");

        db.ref('players/' + phone).once('value').then(snap => {
            if(snap.exists()) return showAppAlert("Phone number already registered!");

            db.ref('players/' + phone).set({
                name: name,
                phone: phone,
                password: pass,
                age: age,
                wallet: 0,
                username: name,
                createdAt: Date.now()
            }).then(() => {
                showAppAlert("Account Created! Please Login.", "Success");
                goto('login');
            }).catch(e => {
                showAppAlert("Error creating account: " + e.message, "Error");
            });
        }).catch(e => {
            showAppAlert("Error checking user existence: " + e.message, "Error");
        });
    }

    function handleLogin() {
        if (!db) return showAppAlert("Database connection failed.");
        const phone = document.getElementById('login_phone').value.trim();
        const pass = document.getElementById('login_pass').value.trim();

        if(!phone || !pass) return showAppAlert("Enter phone and password");

        db.ref('players/' + phone).once('value').then(snap => {
            if(!snap.exists()) return showAppAlert("User not found. Please Sign Up.");

            const user = snap.val();
            if(user.password !== pass) return showAppAlert("Incorrect Password");

            currentUserPhone = phone;
            localStorage.setItem('arena_phone', phone);

            startSession();
        }).catch(e => {
            showAppAlert("Error during login: " + e.message, "Error");
        });
    }

    function handleLogout() {
        currentUserPhone = null;
        localStorage.removeItem('arena_phone');
        goto('login');
    }

    function startSession() {
        if(!db) return;
        db.ref('players/' + currentUserPhone).on('value', snap => {
            const d = snap.val();
            currentBalance = (d && d.wallet) ? d.wallet : 0;
            document.getElementById('txt_wallet').innerText = "₹" + currentBalance;
            document.getElementById('txt_wallet_big').innerText = "₹" + currentBalance;
            document.getElementById('txt_welcome').innerText = "Hi, " + (d.name || "Player");
            document.getElementById('txt_welcome_name').innerText = (d.name || "Player");
            document.getElementById('txt_welcome_small').innerText = "Welcome back";
        });
        goto('dash');
    }

    // --- BOOKING LOGIC ---
    function loadTables() {
        if (!db) return;
        const sel = document.getElementById('sel_table');
        sel.innerHTML = '<option disabled selected>Select a Table...</option>';

        db.ref('tables').once('value').then(snap => {
            const tables = snap.val() || {};
            Object.entries(tables).forEach(([id, t]) => {
                const opt = document.createElement('option');
                opt.value = id;
                opt.text = `${t.name} (Cap: ${t.capacity || 4})`;
                opt.setAttribute('data-cap', t.capacity || 4);
                opt.setAttribute('data-price', t.pricePerSlot || 0);
                sel.appendChild(opt);
            });
        });
    }

    function handleTableChange() {
        const sel = document.getElementById('sel_table');
        selectedTableId = sel.value;

        document.getElementById('slots_list').innerHTML = '<div style="text-align:center; color:#9aa3a8;">Loading Slots...</div>';
        document.getElementById('action_bar').style.display = 'none';

        const opt = sel.options[sel.selectedIndex];
        currentTableCapacity = parseInt(opt.getAttribute('data-cap')) || 4;
        selectedSlotPrice = parseInt(opt.getAttribute('data-price')) || 0;
        loadSlots();
    }

    function toggleMoreDates() {
        maxDaysToShow = (maxDaysToShow === 7) ? TOTAL_DAYS_TO_SHOW : 7;
        renderCalendar();
    }

    function renderCalendar() {
        const strip = document.getElementById('calendar_strip');
        strip.innerHTML = '';
        const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        const today = new Date();
        for(let i=0;i<maxDaysToShow;i++){
            const d = new Date(today);
            d.setDate(today.getDate() + i);
            const dateStr = d.toISOString().split('T')[0];
            const el = document.createElement('div');
            el.className = 'cal-day';
            if(selectedDateStr === dateStr) el.classList.add('selected');
            el.innerHTML = `<div style="font-size:10px;color:var(--muted);margin-bottom:6px;">${days[d.getDay()]}</div><div style="font-weight:800;font-size:16px;">${d.getDate()}</div>`;
            el.onclick = () => {
                selectedDateStr = dateStr;
                renderCalendar();
                if(selectedTableId) loadSlots();
            };
            strip.appendChild(el);
        }

        if(maxDaysToShow < TOTAL_DAYS_TO_SHOW){
            const showMore = document.createElement('div');
            showMore.className = 'cal-day';
            showMore.style.minWidth = '110px';
            showMore.style.display = 'flex';
            showMore.style.alignItems = 'center';
            showMore.style.justifyContent = 'center';
            showMore.style.flexDirection = 'column';
            showMore.style.color = 'var(--accent)';
            showMore.style.borderColor = 'rgba(62,224,122,0.12)';
            showMore.onclick = toggleMoreDates;
            showMore.innerHTML = `<div style="font-weight:700">Show More Dates</div><div class="small muted" style="margin-top:6px;">${TOTAL_DAYS_TO_SHOW} days</div>`;
            strip.appendChild(showMore);
        }
    }

    function loadSlots() {
        if(!db || !selectedTableId) return;
        const list = document.getElementById('slots_list');
        document.getElementById('day_block_banner').style.display = 'none';

        Promise.all([
            db.ref(`tables/${selectedTableId}`).once('value'),
            db.ref('bookings').orderByChild('date').equalTo(selectedDateStr).once('value'),
            db.ref(`dayBlocks/${selectedDateStr}`).once('value'),
            db.ref('maintenanceBlocks').once('value')
        ]).then(([tSnap,bSnap,daySnap,maintSnap]) => {
            if (daySnap.exists() && daySnap.val().noTT) {
                document.getElementById('day_block_banner').style.display = 'block';
                document.getElementById('day_block_banner').innerText = `⛔ ${daySnap.val().reason || "Day Blocked by Admin"}`;
                list.innerHTML = '<div style="text-align:center; color:#9aa3a8; margin-top:30px;">Booking disabled for this date.</div>';
                return;
            }

            const tableData = tSnap.val();
            const allBookings = Object.values(bSnap.val() || {});
            const slots = Array.isArray(tableData.slots) ? tableData.slots : (tableData.slots ? Object.values(tableData.slots) : []);
            const maintBlocks = Object.values(maintSnap.val() || {}).filter(b => b.date === selectedDateStr && b.tableId === selectedTableId);
            list.innerHTML = '';

            if(!slots || slots.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:#9aa3a8;margin-top:30px;">No slots configured.</div>';
                return;
            }

            slots.forEach(time => {
                const startTime = time.split('-')[0];
                let isMaint = false;
                maintBlocks.forEach(mb => { if(startTime >= mb.from && startTime < mb.to) isMaint = true; });

                const bookingsForSlot = allBookings.filter(b => b.tableId === selectedTableId && b.slot === time);
                const bookedSeats = bookingsForSlot.reduce((sum,b) => sum + (b.seats || 1), 0);
                const available = currentTableCapacity - bookedSeats;
                const isFull = available <= 0;

                const el = document.createElement('div');
                el.className = 'slot-item';
                let badgeHtml = '';

                if(isMaint){
                    el.classList.add('maintenance');
                    badgeHtml = `<div class="status-badge maint">MAINTENANCE</div>`;
                } else if(isFull){
                    el.classList.add('full');
                    badgeHtml = `<div class="status-badge">FULL</div>`;
                } else {
                    badgeHtml = `<div class="status-badge ${available < 2 ? 'low' : ''}">${available} Left</div>`;
                }

                el.innerHTML = `
                    <div class="slot-details">
                      <div>${time}</div>
                      <div>Price: ₹${tableData.pricePerSlot} / seat</div>
                    </div>
                    ${badgeHtml}
                `;
                if(!isFull && !isMaint) {
                    el.onclick = () => openQuantitySelector(time, available, el);
                }
                list.appendChild(el);
            });

        }).catch(e => {
            document.getElementById('slots_list').innerHTML = `<div style="text-align:center;color:#ffb3b3;margin-top:30px;">Error: ${e.message}</div>`;
        });
    }

    // --- QUANTITY & CONFIRM ---
    let maxAvailableForSlot = 0;
    function openQuantitySelector(time, available, elRef) {
        document.querySelectorAll('.slot-item').forEach(e => e.classList.remove('selected'));
        elRef.classList.add('selected');

        selectedSlotTime = time;
        maxAvailableForSlot = available;
        selectedQty = 1;

        const container = document.querySelector('.qty-selector');
        container.innerHTML = '';
        const limit = Math.min(maxAvailableForSlot,4);
        for(let i=1;i<=limit;i++){
            const btn = document.createElement('div');
            btn.className = `qty-btn ${i===1 ? 'active' : ''}`;
            btn.innerText = i;
            btn.onclick = () => setQty(i);
            container.appendChild(btn);
        }

        updatePriceDisplay();
        document.getElementById('action_bar').style.display = 'block';
        document.getElementById('action_bar').setAttribute('aria-hidden','false');
    }

    function setQty(n) {
        selectedQty = n;
        document.querySelectorAll('.qty-btn').forEach(b => b.classList.remove('active'));
        const found = Array.from(document.querySelectorAll('.qty-btn')).find(b => b.innerText == n);
        if(found) found.classList.add('active');
        updatePriceDisplay();
    }

    function updatePriceDisplay() {
        const total = selectedSlotPrice * selectedQty;
        document.getElementById('lbl_total_price').innerText = "₹" + total;
    }

    function confirmBook() {
        if (!db) return showAppAlert("Database connection failed.");
        if (!selectedTableId) return showAppAlert("Please select a table first!");
        const totalPrice = selectedSlotPrice * selectedQty;
        if(currentBalance < totalPrice) return showAppAlert("Insufficient Wallet Balance!");
        db.ref('bookings').push({
            date: selectedDateStr,
            tableId: selectedTableId,
            slot: selectedSlotTime,
            playerUsername: currentUserPhone,
            seats: selectedQty,
            status: 'confirmed',
            createdAt: Date.now()
        }).then(() => {
            const newBal = currentBalance - totalPrice;
            db.ref('players/' + currentUserPhone).update({ wallet: newBal });

            db.ref('transactions').push({
                type: 'booking',
                username: currentUserPhone,
                amount: -totalPrice,
                reason: `Booked ${selectedTableId} (${selectedQty} seats)`,
                createdAt: Date.now()
            });

            showAppAlert("Booking Successful!", "Success");
            goto('mybookings');
        }).catch(e => showAppAlert(e.message, "Booking Error"));
    }

    // --- MY BOOKINGS ---
    function loadMyBookings() {
        if (!db) return;
        const list = document.getElementById('list_mybookings');
        list.innerHTML = '<div style="text-align:center; color:#9aa3a8;">Loading...</div>';

        Promise.all([
            db.ref('bookings').once('value'),
            db.ref('dayBlocks').once('value'),
            db.ref('maintenanceBlocks').once('value')
        ]).then(([bSnap,dSnap,mSnap]) => {
            const bookings = [];
            const dayBlocks = dSnap.val() || {};
            const maintBlocks = mSnap.val() || {};

            bSnap.forEach(c => {
                const booking = c.val();
                if(booking.playerUsername === currentUserPhone){
                    let status = booking.status;
                    let cancellationReason = null;

                    const dayBlock = dayBlocks[booking.date];
                    if (dayBlock && dayBlock.noTT && status === 'confirmed') {
                        status = 'admin_cancelled';
                        cancellationReason = dayBlock.reason || 'Admin Day Block (Full Day)';
                    } else {
                        const [startTime, endTime] = booking.slot.split('-');
                        Object.values(maintBlocks).forEach(mb => {
                            if (mb.date === booking.date && mb.tableId === booking.tableId && status === 'confirmed') {
                                if (startTime >= mb.from && startTime < mb.to) {
                                    status = 'admin_cancelled';
                                    cancellationReason = mb.reason || 'Maintenance Block (Slot)';
                                }
                            }
                        });
                    }

                    if (status === 'admin_cancelled' && booking.status === 'confirmed') {
                        db.ref('bookings/' + c.key).update({ status: 'admin_cancelled', adminCancelledReason: cancellationReason });
                    }

                    bookings.push({ key: c.key, ...booking, status: status, cancellationReason: cancellationReason || booking.adminCancelledReason });
                }
            });

            bookings.sort((a,b) => b.createdAt - a.createdAt);
            list.innerHTML = '';
            if(bookings.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:#9aa3a8;margin-top:40px;">No bookings found.</div>';
                return;
            }

            bookings.forEach(b => {
                const item = document.createElement('div');
                item.className = 'card';
                let actionButtonHtml = '';
                let statusBadgeHtml = '';
                let detailsColor = '#aaa';

                if (b.status === 'admin_cancelled') {
                    statusBadgeHtml = `<span style="color:#ff9b9b;font-size:12px;font-weight:700;display:block;margin-bottom:10px;">CANCELLED (Admin)</span>`;
                    actionButtonHtml = `<p style="color:#ffb74d;font-size:13px;margin:0;">Reason: ${b.cancellationReason || 'Unknown Admin Reason'}</p>`;
                    detailsColor = '#888';
                } else {
                    statusBadgeHtml = `<span style="color:var(--accent);font-size:12px;font-weight:700;display:block;margin-bottom:10px;">CONFIRMED</span>`;
                    actionButtonHtml = `<button class="btn-ghost" style="width:100%;" onclick="requestCancelBooking('${b.key}')">Cancel Booking</button>`;
                }

                item.innerHTML = `
                    ${statusBadgeHtml}
                    <div style="display:flex;justify-content:space-between;color:#eafdf2;font-weight:700;margin-bottom:6px;">
                        <span>${b.date}</span>
                        <span>${b.slot}</span>
                    </div>
                    <div style="font-size:13px;color:${detailsColor};margin-bottom:12px;">
                        Table: ${b.tableId} • Seats: ${b.seats || 1}
                    </div>
                    ${actionButtonHtml}
                `;
                list.appendChild(item);
            });

        }).catch(e => {
            list.innerHTML = `<div style="text-align:center;color:#ff9b9b;margin-top:40px;">Error loading bookings: ${e.message}</div>`;
        });
    }

    window.requestCancelBooking = (key) => {
        showAppConfirm("Cancel booking? (No Refund)", () => {
            if (!db) return;
            db.ref('bookings/' + key).remove().then(() => {
                showAppAlert("Cancelled (No Refund)", "Cancellation");
                loadMyBookings();
            });
        }, "Cancel Booking");
    };

    // --- RECHARGE ---
    window.showRecharge = () => {
        document.getElementById('modal_recharge').style.display = 'flex';
    }
    window.doRecharge = () => {
        if (!db) return showAppAlert("Database connection failed.");
        const code = document.getElementById('inp_code').value.trim().toUpperCase();
        if(!code) return;
        db.ref('rechargeCodes/' + code).once('value').then(snap => {
            if(!snap.exists() || snap.val().isUsed) return showAppAlert("Invalid or Used Code");
            const val = snap.val().value;

            db.ref('rechargeCodes/' + code).update({ isUsed: true, usedBy: currentUserPhone, usedAt: Date.now() });
            db.ref('players/' + currentUserPhone).update({ wallet: currentBalance + val });

            db.ref('transactions').push({
                type: 'recharge',
                username: currentUserPhone,
                amount: val,
                code: code,
                createdAt: Date.now()
            });

            showAppAlert(`Added ₹${val} to wallet!`, "Recharge Success");
            document.getElementById('modal_recharge').style.display = 'none';
        });
    }

    // initial boot
    if(currentUserPhone) startSession();
    else goto('login');

  </script>

</body>
</html>
